A demo virtual DOM mounting + patching algorithm.

<div id="app"></div>

<script>
function h(tag, attrs, children) {
  return {
    tag,
    attrs,
    children: children && children.map(c => {
      if (typeof c === 'string') {
        return {
          text: c
        }
      } else {
        return c
      }
    })
  }
}

function mount(vdom, container) {
  if (vdom.text) {
    mountText(vdom, container)
  } else {
    mountElement(vdom, container)
  }
}

function mountElement(vdom, container) {
  const { tag, attrs, children } = vdom

  const el = document.createElement(tag)

  vdom.el = el

  if (attrs) {
    for (const key in attrs) {
      el.setAttribute(key, attrs[key])
    }
  }

  if (children) {
    children.forEach(child => {
      mount(child, el)
    })
  }

  container.appendChild(el)
}

function mountText(vdom, container) {
  const text = document.createTextNode(vdom.text)
  vdom.el = text
  container.appendChild(text)
}

function patch(vdom1, vdom2) {
  const isText1 = !!vdom1.text
  const isText2 = !!vdom2.text
  if (isText1 && isText2) {
    patchText(vdom1, vdom2)
  } else if (!isText1 && !isText2) {
    patchElement(vdom1, vdom2)
  } else {
    replaceNode(vdom1, vdom2)
  }
}

function patchText(vdom1, vdom2) {
  const el = vdom2.el = vdom1.el
  if (vdom2.text !== vdom1.text) {
    el.textContent = vdom2.text
  }
}

function patchElement(vdom1, vdom2) {
  if (vdom1.tag !== vdom2.tag) {
    replaceNode(vdom1, vdom2)
    return
  }

  const el = vdom2.el = vdom1.el

  // diff attrs
  // update different ones
  // remove ones that are no longer present

  // diff children
  const oldChildren = vdom1.children
  const newChildren = vdom2.children

  newChildren.forEach((newChild, i) => {
    const oldChild = oldChildren[i]
    if (oldChild) {
      patch(oldChild, newChild)
    } else {
      mount(newChild, el)
    }
  })

  if (oldChildren.length > newChildren.length) {
    oldChildren.slice(newChildren.length).forEach(oldChild => {
      // remove oldChild
    })
  }
}

function replaceNode(vdom1, vdom2) {
  // remove vdom1
  // mount vdom2
}

function render(state) {
  return h('div', { id: 'foo' }, [
    h('span', null, [state.msg]),
    h('span', null, ['world'])
  ])
}

// app boot up
const vdom1 = render({
  msg: 'hello'
})

mount(vdom1, document.getElementById('app'))

// this.msg = 'bye'
const vdom2 = render({
  msg: 'bye'
})

patch(vdom1, vdom2)
</script>
